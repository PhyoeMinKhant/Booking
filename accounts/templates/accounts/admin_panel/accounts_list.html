{% extends 'accounts/admin_panel/base.html' %}

{% block title %}Accounts{% endblock %}

{% block content %}
  <header class="page-header page-header--row">
    <div>
      <h2>Accounts</h2>
      <p>Manage user accounts and profiles</p>
    </div>
    <a class="btn btn-primary" href="{% url 'panel_account_create' %}">New Account</a>
  </header>

  <form method="get" class="filter-bar">
    <label class="field field--inline">
      <span>Account Type</span>
      <select name="account_type">
        {% for value, label in account_type_options %}
          <option value="{{ value }}" {% if account_type_filter == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </label>
    <button class="btn" type="submit">Filter</button>
  </form>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Email</th>
          <th>Type</th>
          <th>License</th>
          <th>Hotel Review</th>
          <th>Staff</th>
          <th>Active</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
          <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.username }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.profile.get_account_type_display }}</td>
            <td>
              {% if user.profile.account_type == "hotel" and user.profile.hotel_license_image %}
                <a href="{{ user.profile.hotel_license_image.url }}" target="_blank" rel="noopener" class="btn btn-small">
                  Open
                </a>
              {% elif user.profile.account_type == "hotel" %}
                Missing
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if user.profile.account_type == "hotel" %}
                {{ user.profile.get_hotel_verification_status_display }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>{% if user.is_staff %}Yes{% else %}No{% endif %}</td>
            <td>{% if user.is_active %}Yes{% else %}No{% endif %}</td>
            <td class="actions-cell">
              <a class="btn btn-small" href="{% url 'panel_account_edit' user.id %}">Edit</a>
              {% if user.profile.account_type == "hotel" and user.profile.hotel_verification_status != "approved" %}
                <form method="post" action="{% url 'panel_account_approve_hotel' user.id %}">
                  {% csrf_token %}
                  <button class="btn btn-small" type="submit">Approve</button>
                </form>
              {% endif %}
              {% if user.profile.account_type == "hotel" and user.profile.hotel_verification_status != "rejected" %}
                <form method="post" action="{% url 'panel_account_reject_hotel' user.id %}">
                  {% csrf_token %}
                  <button class="btn btn-small btn-danger" type="submit">Reject</button>
                </form>
              {% endif %}
              {% if user.id != request.user.id %}
                <form method="post" action="{% url 'panel_account_delete' user.id %}">
                  {% csrf_token %}
                  <button class="btn btn-small btn-danger" type="submit">Delete</button>
                </form>
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="9">No accounts found.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
